// app_server/views/browse.jade (UPDATED)
extends layout

block content
  h2.mb-4 Browse All Listings

  .row


    // Main Listing Area (full width)
    .col-12
      // Search and Sort Options
      .d-flex.justify-content-between.align-items-center.mb-3
        form.d-flex(action='/browse', method='GET', style='width: 300px;')
          input.form-control.me-2(type='search', name='search', placeholder='Search items...', value=searchQuery)
          button.btn.btn-outline-primary(type='submit') Search
        .d-flex.align-items-center
          label.me-2(for='sort-by') Sort by:
          select.form-select(id='sort-by', style='width: 150px;')
            option Newest
            option Price: Low to High
            option Price: High to Low
            option Condition

      // Grid for Listings
      .row.g-4
        if items && items.length
          each item in items
            .col-md-6.col-xl-4
              .card.h-100
                // Optional image if present (placeholder otherwise)
                - var imgSrc = item.imageUrl || ('https://via.placeholder.com/300x200?text=' + encodeURIComponent(item.name || 'Item'))
                img.card-img-top(src=imgSrc, alt='Item Image')
                .card-body.d-flex.flex-column
                  h5.card-title #{item.name}
                  h6.card-subtitle.mb-2.text-success $#{item.price}
                  p.card-text.flex-grow-1 #{item.description}
                  if item.seller && item.seller.email
                    small.text-muted Posted by #{item.seller.email}
                  .mt-2.d-flex.gap-2
                    a.btn.btn-sm.btn-primary(href='#') View Details
                    if user && item.seller && user._id && item.seller._id && user._id.toString() === item.seller._id.toString()
                      form(action='/delete-item/' + item._id, method='POST', style='display: inline;')
                        button.btn.btn-sm.btn-danger(type='submit', onclick='return confirm("Are you sure you want to delete this item?")') Delete
        else
          .col-12
            .alert.alert-info No listings found. Try uploading an item!