doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1.0')
    title= title + " - Marketplace App"
    link(rel='stylesheet', href='https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css')
    link(rel='stylesheet', href='/stylesheets/style.css')
    
  body.bg-gray-100.min-h-screen
    
    // --- Navigation Bar (Header) ---
    header.bg-white.shadow-md
      nav.container.mx-auto.px-6.py-3.flex.justify-between.items-center
        a.text-xl.font-bold.text-gray-800(href='/') Marketplace
        
        div.flex.space-x-4.items-center
          a(href='/', class='text-gray-600 hover:text-gray-900') Home
          a(href='/browse', class='text-gray-600 hover:text-gray-900') View All Listings
          if user
            a(href='/upload', class='text-gray-600 hover:text-gray-900') Upload an Item

          // FIX: The 'if user' block handles the undefined check
          if user 
            // If user is defined (logged in), display email and logout
            span.text-green-600.font-semibold Logged in as #{user.email} 
            a(href='/auth/logout', class='bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded') Logout
          else
            // If user is undefined (not logged in), display login and register
            a(href='/auth/login', class='bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded') Login
            a(href='/auth/register', class='bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded') Register

    // --- Main Content Block ---
    main.container.mx-auto.mt-8.p-4
      // Flash messages
      if messages && messages.error
        each msg in messages.error
          .bg-red-100.border.border-red-400.text-red-700.px-4.py-3.rounded.mb-4(role='alert')
            strong.font-bold Error: 
            |  #{msg}

      if messages && messages.success
        each msg in messages.success
          .bg-green-100.border.border-green-400.text-green-700.px-4.py-3.rounded.mb-4(role='alert')
            strong.font-bold Success: 
            |  #{msg}

      block content 
    
    // --- Footer ---
    footer.mt-auto.py-4.text-center.text-gray-500
      p Â© 2025 Marketplace App. All rights reserved.